[
  {
    "id": 1,
    "description": "Missing index on users.age filter",
    "schema": "\nCREATE TABLE users (\n    id INTEGER PRIMARY KEY,\n    name TEXT,\n    email TEXT,\n    age INTEGER,\n    city TEXT,\n    signup_date TEXT\n);\n",
    "slow_query": "SELECT * FROM users WHERE age > 30;",
    "fast_query": "\nCREATE INDEX IF NOT EXISTS idx_users_age ON users(age);\nSELECT * FROM users WHERE age > 30;\n",
    "explanation": "Index on age column speeds up WHERE filtering",
    "optimization_type": "indexing"
  },
  {
    "id": 2,
    "description": "SELECT * when only few columns needed",
    "schema": "\nCREATE TABLE users (\n    id INTEGER PRIMARY KEY,\n    name TEXT,\n    email TEXT,\n    age INTEGER,\n    city TEXT,\n    signup_date TEXT\n);\n",
    "slow_query": "SELECT * FROM users WHERE city = 'NYC';",
    "fast_query": "\nCREATE INDEX IF NOT EXISTS idx_users_city ON users(city);\nSELECT id, name, email FROM users WHERE city = 'NYC';\n",
    "explanation": "Select only needed columns and add index",
    "optimization_type": "projection"
  },
  {
    "id": 3,
    "description": "IN subquery for finding users with orders",
    "schema": "\nCREATE TABLE users (\n    id INTEGER PRIMARY KEY,\n    name TEXT,\n    email TEXT,\n    age INTEGER,\n    city TEXT,\n    signup_date TEXT\n);\nCREATE TABLE orders (\n    id INTEGER PRIMARY KEY,\n    user_id INTEGER,\n    product TEXT,\n    amount REAL,\n    order_date TEXT\n);\n",
    "slow_query": "\nSELECT name, email FROM users \nWHERE id IN (SELECT user_id FROM orders WHERE amount > 100);\n",
    "fast_query": "\nCREATE INDEX IF NOT EXISTS idx_orders_amount ON orders(amount);\nCREATE INDEX IF NOT EXISTS idx_orders_user_id ON orders(user_id);\nSELECT DISTINCT u.name, u.email \nFROM users u \nINNER JOIN orders o ON u.id = o.user_id \nWHERE o.amount > 100;\n",
    "explanation": "JOIN with indexes faster than IN subquery",
    "optimization_type": "join"
  },
  {
    "id": 4,
    "description": "Scanning all orders without LIMIT",
    "schema": "\nCREATE TABLE orders (\n    id INTEGER PRIMARY KEY,\n    user_id INTEGER,\n    product TEXT,\n    amount REAL,\n    order_date TEXT\n);\n",
    "slow_query": "SELECT * FROM orders ORDER BY order_date DESC;",
    "fast_query": "\nCREATE INDEX IF NOT EXISTS idx_orders_date ON orders(order_date DESC);\nSELECT * FROM orders ORDER BY order_date DESC LIMIT 100;\n",
    "explanation": "Add LIMIT and index for ordered results",
    "optimization_type": "limit"
  },
  {
    "id": 5,
    "description": "Multiple OR conditions on city",
    "schema": "\nCREATE TABLE users (\n    id INTEGER PRIMARY KEY,\n    name TEXT,\n    email TEXT,\n    age INTEGER,\n    city TEXT,\n    signup_date TEXT\n);\n",
    "slow_query": "\nSELECT * FROM users \nWHERE city = 'NYC' OR city = 'LA' OR city = 'Chicago';\n",
    "fast_query": "\nCREATE INDEX IF NOT EXISTS idx_users_city ON users(city);\nSELECT * FROM users \nWHERE city IN ('NYC', 'LA', 'Chicago');\n",
    "explanation": "IN clause with index faster than multiple ORs",
    "optimization_type": "indexing"
  },
  {
    "id": 6,
    "description": "Filter on user_id and amount without index",
    "schema": "\nCREATE TABLE orders (\n    id INTEGER PRIMARY KEY,\n    user_id INTEGER,\n    product TEXT,\n    amount REAL,\n    order_date TEXT\n);\n",
    "slow_query": "\nSELECT * FROM orders \nWHERE user_id = 123 AND amount > 50;\n",
    "fast_query": "\nCREATE INDEX IF NOT EXISTS idx_orders_user_amount ON orders(user_id, amount);\nSELECT * FROM orders \nWHERE user_id = 123 AND amount > 50;\n",
    "explanation": "Composite index on both filter columns",
    "optimization_type": "indexing"
  },
  {
    "id": 7,
    "description": "Using COUNT when only need existence check",
    "schema": "\nCREATE TABLE users (\n    id INTEGER PRIMARY KEY,\n    name TEXT,\n    email TEXT,\n    age INTEGER,\n    city TEXT,\n    signup_date TEXT\n);\nCREATE TABLE orders (\n    id INTEGER PRIMARY KEY,\n    user_id INTEGER,\n    product TEXT,\n    amount REAL,\n    order_date TEXT\n);\n",
    "slow_query": "\nSELECT u.name, \n       (SELECT COUNT(*) FROM orders WHERE user_id = u.id) as order_count\nFROM users u\nWHERE (SELECT COUNT(*) FROM orders WHERE user_id = u.id) > 0;\n",
    "fast_query": "\nCREATE INDEX IF NOT EXISTS idx_orders_user_id ON orders(user_id);\nSELECT u.name, COUNT(o.id) as order_count\nFROM users u\nINNER JOIN orders o ON u.id = o.user_id\nGROUP BY u.id, u.name;\n",
    "explanation": "JOIN with GROUP BY faster than correlated subqueries",
    "optimization_type": "join"
  },
  {
    "id": 8,
    "description": "ORDER BY age without supporting index",
    "schema": "\nCREATE TABLE users (\n    id INTEGER PRIMARY KEY,\n    name TEXT,\n    email TEXT,\n    age INTEGER,\n    city TEXT,\n    signup_date TEXT\n);\n",
    "slow_query": "\nSELECT name, email FROM users \nWHERE city = 'NYC' \nORDER BY age DESC;\n",
    "fast_query": "\nCREATE INDEX IF NOT EXISTS idx_users_city_age ON users(city, age DESC);\nSELECT name, email FROM users \nWHERE city = 'NYC' \nORDER BY age DESC;\n",
    "explanation": "Composite index covering WHERE and ORDER BY",
    "optimization_type": "indexing"
  },
  {
    "id": 9,
    "description": "GROUP BY product without index",
    "schema": "\nCREATE TABLE orders (\n    id INTEGER PRIMARY KEY,\n    user_id INTEGER,\n    product TEXT,\n    amount REAL,\n    order_date TEXT\n);\n",
    "slow_query": "\nSELECT product, SUM(amount) as total_sales\nFROM orders\nGROUP BY product;\n",
    "fast_query": "\nCREATE INDEX IF NOT EXISTS idx_orders_product ON orders(product);\nSELECT product, SUM(amount) as total_sales\nFROM orders\nGROUP BY product;\n",
    "explanation": "Index on GROUP BY column speeds up aggregation",
    "optimization_type": "indexing"
  },
  {
    "id": 10,
    "description": "Find users without orders using NOT IN",
    "schema": "\nCREATE TABLE users (\n    id INTEGER PRIMARY KEY,\n    name TEXT,\n    email TEXT,\n    age INTEGER,\n    city TEXT,\n    signup_date TEXT\n);\nCREATE TABLE orders (\n    id INTEGER PRIMARY KEY,\n    user_id INTEGER,\n    product TEXT,\n    amount REAL,\n    order_date TEXT\n);\n",
    "slow_query": "\nSELECT * FROM users \nWHERE id NOT IN (SELECT user_id FROM orders);\n",
    "fast_query": "\nCREATE INDEX IF NOT EXISTS idx_orders_user_id ON orders(user_id);\nSELECT u.* FROM users u\nLEFT JOIN orders o ON u.id = o.user_id\nWHERE o.user_id IS NULL;\n",
    "explanation": "LEFT JOIN with NULL check faster than NOT IN",
    "optimization_type": "join"
  },
  {
    "id": 11,
    "description": "Date range query without index",
    "schema": "\nCREATE TABLE orders (\n    id INTEGER PRIMARY KEY,\n    user_id INTEGER,\n    product TEXT,\n    amount REAL,\n    order_date TEXT\n);\n",
    "slow_query": "\nSELECT * FROM orders \nWHERE order_date >= '2024-01-01' AND order_date < '2024-02-01';\n",
    "fast_query": "\nCREATE INDEX IF NOT EXISTS idx_orders_date ON orders(order_date);\nSELECT * FROM orders \nWHERE order_date >= '2024-01-01' AND order_date < '2024-02-01';\n",
    "explanation": "Index on date column for range queries",
    "optimization_type": "indexing"
  },
  {
    "id": 12,
    "description": "Correlated subquery for total order amount",
    "schema": "\nCREATE TABLE users (\n    id INTEGER PRIMARY KEY,\n    name TEXT,\n    email TEXT,\n    age INTEGER,\n    city TEXT,\n    signup_date TEXT\n);\nCREATE TABLE orders (\n    id INTEGER PRIMARY KEY,\n    user_id INTEGER,\n    product TEXT,\n    amount REAL,\n    order_date TEXT\n);\n",
    "slow_query": "\nSELECT \n    name,\n    (SELECT SUM(amount) FROM orders WHERE user_id = u.id) as total_spent\nFROM users u;\n",
    "fast_query": "\nCREATE INDEX IF NOT EXISTS idx_orders_user_id ON orders(user_id);\nSELECT \n    u.name,\n    COALESCE(SUM(o.amount), 0) as total_spent\nFROM users u\nLEFT JOIN orders o ON u.id = o.user_id\nGROUP BY u.id, u.name;\n",
    "explanation": "Replace correlated subquery with JOIN and aggregation",
    "optimization_type": "join"
  },
  {
    "id": 13,
    "description": "Large OFFSET for pagination",
    "schema": "\nCREATE TABLE orders (\n    id INTEGER PRIMARY KEY,\n    user_id INTEGER,\n    product TEXT,\n    amount REAL,\n    order_date TEXT\n);\n",
    "slow_query": "\nSELECT * FROM orders \nORDER BY id \nLIMIT 20 OFFSET 10000;\n",
    "fast_query": "\nSELECT * FROM orders \nWHERE id > 10000 \nORDER BY id \nLIMIT 20;\n",
    "explanation": "Use WHERE with index instead of large OFFSET",
    "optimization_type": "indexing"
  },
  {
    "id": 14,
    "description": "Join large tables without pre-filtering",
    "schema": "\nCREATE TABLE users (\n    id INTEGER PRIMARY KEY,\n    name TEXT,\n    email TEXT,\n    age INTEGER,\n    city TEXT,\n    signup_date TEXT\n);\nCREATE TABLE orders (\n    id INTEGER PRIMARY KEY,\n    user_id INTEGER,\n    product TEXT,\n    amount REAL,\n    order_date TEXT\n);\n",
    "slow_query": "\nSELECT o.* FROM orders o\nJOIN users u ON o.user_id = u.id\nWHERE u.city = 'NYC';\n",
    "fast_query": "\nCREATE INDEX IF NOT EXISTS idx_users_city ON users(city);\nCREATE INDEX IF NOT EXISTS idx_orders_user_id ON orders(user_id);\nSELECT o.* FROM users u\nJOIN orders o ON u.id = o.user_id\nWHERE u.city = 'NYC';\n",
    "explanation": "Add indexes and filter smaller table first",
    "optimization_type": "indexing"
  },
  {
    "id": 15,
    "description": "Using HAVING when WHERE would filter earlier",
    "schema": "\nCREATE TABLE orders (\n    id INTEGER PRIMARY KEY,\n    user_id INTEGER,\n    product TEXT,\n    amount REAL,\n    order_date TEXT\n);\n",
    "slow_query": "\nSELECT user_id, COUNT(*) as order_count\nFROM orders\nGROUP BY user_id\nHAVING amount > 100;\n",
    "fast_query": "\nCREATE INDEX IF NOT EXISTS idx_orders_amount_user ON orders(amount, user_id);\nSELECT user_id, COUNT(*) as order_count\nFROM orders\nWHERE amount > 100\nGROUP BY user_id;\n",
    "explanation": "Use WHERE to filter before GROUP BY, not HAVING",
    "optimization_type": "indexing"
  },
  {
    "id": 16,
    "description": "Multiple aggregations with separate scans",
    "schema": "\nCREATE TABLE orders (\n    id INTEGER PRIMARY KEY,\n    user_id INTEGER,\n    product TEXT,\n    amount REAL,\n    order_date TEXT\n);\n",
    "slow_query": "\nSELECT \n    user_id,\n    (SELECT COUNT(*) FROM orders o1 WHERE o1.user_id = o.user_id) as order_count,\n    (SELECT SUM(amount) FROM orders o2 WHERE o2.user_id = o.user_id) as total_amount\nFROM orders o\nGROUP BY user_id;\n",
    "fast_query": "\nCREATE INDEX IF NOT EXISTS idx_orders_user_id ON orders(user_id);\nSELECT \n    user_id,\n    COUNT(*) as order_count,\n    SUM(amount) as total_amount\nFROM orders\nGROUP BY user_id;\n",
    "explanation": "Single GROUP BY faster than multiple subqueries",
    "optimization_type": "join"
  },
  {
    "id": 17,
    "description": "Filter on computed age range",
    "schema": "\nCREATE TABLE users (\n    id INTEGER PRIMARY KEY,\n    name TEXT,\n    email TEXT,\n    age INTEGER,\n    city TEXT,\n    signup_date TEXT\n);\n",
    "slow_query": "\nSELECT * FROM users \nWHERE age / 10 = 3;\n",
    "fast_query": "\nCREATE INDEX IF NOT EXISTS idx_users_age ON users(age);\nSELECT * FROM users \nWHERE age >= 30 AND age < 40;\n",
    "explanation": "Avoid functions in WHERE; use range with index",
    "optimization_type": "indexing"
  },
  {
    "id": 18,
    "description": "Find high-value orders by city without indexes",
    "schema": "\nCREATE TABLE users (\n    id INTEGER PRIMARY KEY,\n    name TEXT,\n    email TEXT,\n    age INTEGER,\n    city TEXT,\n    signup_date TEXT\n);\nCREATE TABLE orders (\n    id INTEGER PRIMARY KEY,\n    user_id INTEGER,\n    product TEXT,\n    amount REAL,\n    order_date TEXT\n);\n",
    "slow_query": "\nSELECT u.city, o.amount, o.product\nFROM users u\nJOIN orders o ON u.id = o.user_id\nWHERE o.amount > 500\nORDER BY u.city, o.amount DESC;\n",
    "fast_query": "\nCREATE INDEX IF NOT EXISTS idx_orders_amount ON orders(amount);\nCREATE INDEX IF NOT EXISTS idx_orders_user_id ON orders(user_id);\nCREATE INDEX IF NOT EXISTS idx_users_city ON users(city);\nSELECT u.city, o.amount, o.product\nFROM orders o\nJOIN users u ON o.user_id = u.id\nWHERE o.amount > 500\nORDER BY u.city, o.amount DESC;\n",
    "explanation": "Add indexes on all join and filter columns",
    "optimization_type": "indexing"
  },
  {
    "id": 19,
    "description": "Find recent signups without date index",
    "schema": "\nCREATE TABLE users (\n    id INTEGER PRIMARY KEY,\n    name TEXT,\n    email TEXT,\n    age INTEGER,\n    city TEXT,\n    signup_date TEXT\n);\n",
    "slow_query": "\nSELECT name, email, signup_date FROM users \nWHERE signup_date >= '2024-01-01'\nORDER BY signup_date DESC;\n",
    "fast_query": "\nCREATE INDEX IF NOT EXISTS idx_users_signup ON users(signup_date DESC);\nSELECT name, email, signup_date FROM users \nWHERE signup_date >= '2024-01-01'\nORDER BY signup_date DESC;\n",
    "explanation": "Index on signup_date for filtering and sorting",
    "optimization_type": "indexing"
  },
  {
    "id": 20,
    "description": "Find top spenders without optimization",
    "schema": "\nCREATE TABLE users (\n    id INTEGER PRIMARY KEY,\n    name TEXT,\n    email TEXT,\n    age INTEGER,\n    city TEXT,\n    signup_date TEXT\n);\nCREATE TABLE orders (\n    id INTEGER PRIMARY KEY,\n    user_id INTEGER,\n    product TEXT,\n    amount REAL,\n    order_date TEXT\n);\n",
    "slow_query": "\nSELECT u.name, u.email, SUM(o.amount) as total\nFROM users u\nJOIN orders o ON u.id = o.user_id\nGROUP BY u.id, u.name, u.email\nORDER BY total DESC;\n",
    "fast_query": "\nCREATE INDEX IF NOT EXISTS idx_orders_user_id ON orders(user_id);\nSELECT u.name, u.email, SUM(o.amount) as total\nFROM users u\nJOIN orders o ON u.id = o.user_id\nGROUP BY u.id, u.name, u.email\nORDER BY total DESC\nLIMIT 100;\n",
    "explanation": "Add index and LIMIT for top-N query",
    "optimization_type": "indexing"
  }
]